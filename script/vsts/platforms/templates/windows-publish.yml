steps:
  - script: |
      IF [%BUILD_ARCH%]==[x64] (
        SET FileID=-x64
      ) ELSE (
        SET FileID=
      )
      echo FileID set to: %FileID%
    env:
      BUILD_ARCH: $(buildArch)
    displayName: Set FileID based on the arch

  - task: PublishBuildArtifacts@1
    inputs:
      PathtoPublish: $(Build.SourcesDirectory)/out/atom$(FileID)-windows.zip
      ArtifactName: atom$(FileID)-windows.zip
      ArtifactType: Container
    displayName: Upload atom$(FileID)-windows.zip
    condition: and(succeeded(), ne(variables['Build.Reason'], 'PullRequest'))

  - task: PublishBuildArtifacts@1
    inputs:
      PathtoPublish: $(Build.SourcesDirectory)/out/AtomSetup$(FileID).exe
      ArtifactName: AtomSetup$(FileID).exe
      ArtifactType: Container
    displayName: Upload AtomSetup$(FileID).exe
    condition: and(succeeded(), eq(variables['IsReleaseBranch'], 'true'))

  - task: PublishBuildArtifacts@1
    inputs:
      PathtoPublish: $(Build.SourcesDirectory)/out/$(AppName)$(FileID)-$(ReleaseVersion)-full.nupkg
      ArtifactName: $(AppName)$(FileID)-$(ReleaseVersion)-full.nupkg
      ArtifactType: Container
    displayName: Upload $(AppName)$(FileID)-$(ReleaseVersion)-full.nupkg
    condition: and(succeeded(), eq(variables['IsReleaseBranch'], 'true'))

  - task: PublishBuildArtifacts@1
    inputs:
      PathtoPublish: $(Build.SourcesDirectory)/out/$(AppName)$(FileID)-$(ReleaseVersion)-delta.nupkg
      ArtifactName: $(AppName)$(FileID)-$(ReleaseVersion)-delta.nupkg
      ArtifactType: Container
    displayName: Upload $(AppName)$(FileID)-$(ReleaseVersion)-delta.nupkg
    condition: and(succeeded(), eq(variables['IsReleaseBranch'], 'true'))
    continueOnError: true # Nightly builds don't produce delta packages yet, so don't fail the build

  - task: PublishBuildArtifacts@1
    inputs:
      PathtoPublish: $(Build.SourcesDirectory)/out/RELEASES$(FileID)
      ArtifactName: RELEASES$(FileID)
      ArtifactType: Container
    displayName: Upload RELEASES$(FileID)
    condition: and(succeeded(), eq(variables['IsReleaseBranch'], 'true'))
